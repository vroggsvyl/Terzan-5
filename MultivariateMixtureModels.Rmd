---
title: "Multivariate Mixture Models"
output: html_document
date: "2024-04-17"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Importing the Data
```{r}
library(here)
i_am("MultivariateMixtureModels.Rmd")
# laptop data from csv
#Terzan5 <- readr::read_csv(here("Data", "Terzan 5 X-ray events.csv"), col_types = list(.default = readr::col_guess()), )
# head(Terzan5)

#fishbowl data from ODS
library(readODS)
Terzan5 <- read_ods(here("Raw Data.ods"), col_types = list(.default = readr::col_guess()), )
#removing extraneous columns
T5 <- data.frame(Terzan5$x, Terzan5$y)
colnames(T5) <- c('x','y')

library(ggplot2)
library(ggpointdensity)
library(viridis)

ggplot(T5,aes(x,y)) + 
  geom_pointdensity(adjust = 0.05, size = 0.1, shape = "1") + 
  scale_color_viridis(direction = -1, option = "B", trans = "log", breaks = c(10, 100, 1000, 10000)) + 
  coord_fixed()
```
Filtering down to area of interest
```{r}
library(tidyr)
library(plotly)
interestArea <- T5 %>%
  filter(x>4100 & x<4150 & y>4025 & y<4075)

ggplot(interestArea,aes(x,y)) + 
  geom_pointdensity(adjust = 0.05, size = 0.1, shape = "1") + 
  scale_color_viridis(direction = -1, option = "B", trans = "log", breaks = c(4, 16, 64)) + 
  coord_fixed()
```
```{r}
ggplot(interestArea,aes(x,y)) +
  geom_point(size = 0.5)
```


There is three clearly evident celestial sources in this area.
There are two small areas that could also be celestial sources (located above and below the highest definitive source).

I will be attempting to fit a multivariate mixture model for the entire area. The model will contain three(?) individual 2D Moffat distributions.

The lowest and densest source has already been modelled individually and is denoted as POI2 in previous Rmarkdown files. 

```{r}
library(mixtools)

set.seed(111)
data1 <- cbind(rnorm(100, mean = 0, sd = 1), rnorm(100, mean = 0, sd = 1))
data2 <- cbind(rnorm(100, mean = 5, sd = 1), rnorm(100, mean = 5, sd = 1))

datafull <- rbind(data1, data2)
plot(data1)
plot(data2)
plot(datafull)

fit <- mvnormalmixEM(datafull, k = 2)

names(fit)

fit$lambda
fit$mu
fit$sigma

fit$loglik
#fit$posterior
fit$all.loglik
fit$restarts

plot.mixEM(fit, whichplots = 2)
plot.mixEM(fit, whichplots = 1)
```
From the results 

lambda returns the weightings of each cluster

The mean location of the first cluster (red) is (-0.012, -0.016) 
The mean location of the second cluster (green) is (5.14, 5.02)

Sigma returns the covariance matrixes

```{r}
trial <- mvnormalmixEM(interestArea, k = 3)
```

```{r}
par(pty = "s")
plot.mixEM(trial, whichplots = 2)
```
```{r}
plot.mixEM(trial, whichplots = 1)
trial$lambda
trial$mu
trial$sigma
```

```{r}
library(mixAK)
NMixEM(datafull, K = 2)
```
This returns the same values as the mixtools packages - however it displays it in a much neater way.
