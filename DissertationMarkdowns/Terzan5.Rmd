---
title: "Terzan5"
output:
  word_document: default
  html_document: default
date: "2023-09-28"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Libraries

```{r}
library(here)
library(ggplot2)
library(plotly)
library(readr)
library(ggpointdensity)
library(viridis)
library(tidyr)
```


## Import Data


```{r}
# import data from csv file
Terzan5 <- readr::read_csv(here("Data", "Terzan 5 X-ray events.csv"), col_types = list(.default = readr::col_guess()), )
# head(Terzan5)

# import data from ODS file
# library(readODS)
# Terzan5 <- read_ods(here("Raw Data.ods"), col_types = list(.default = readr::col_guess()), )
#removing extraneous columns
T5 <- data.frame(Terzan5$x, Terzan5$y)
colnames(T5) <- c('x','y')
```


View Data
```{r}
head(Terzan5)
```

Transform Data, remove unneccessary columns
```{r}
T5 <- data.frame(Terzan5$x, Terzan5$y)
colnames(T5) <- c('x','y')
head(T5)
```


# Visualisation
Figure 1.2.1
```{r}
ggplot(T5, aes(x,y))+ geom_point(shape = ".") + coord_fixed()
```

Viewing the dataset via a density heatmap.
Figure 1.2.2
```{r}
modelTerzan5 <- ggplot(T5,aes(x,y)) + 
  geom_pointdensity(adjust = 0.05, size = 0.1, shape = "1") + 
  scale_color_viridis(direction = -1, option = "B", trans = "log", breaks = c(10, 100, 1000, 10000)) + 
  coord_fixed()

modelTerzan5
```

Darker areas indicate areas containing a high number of observations. These indicates the existance of a celestial source. The first aim is to try to fit a Moffat Model to each individual celestial source to predict. By then removing all of the celestial sources and their associated observations, if there is a higher level remaining this is an indication of interstellar gas remaining within the cluster. 

Before getting to that stage, I want to focus on two individual celestial sources that are isolated (unlikely to contain observations that may come from another nearby source).

Choosing two Points of Interest (POI)
```{r}
POI1 <- T5 %>%
  filter(x>4160 & x<4180 & y>4180 & y<4200)
POI2 <- T5 %>%
  filter(x>4105 & x< 4125 & y>4040 & y<4060)
Central <- T5 %>%
  filter(x>4060 & x< 4160 & y>4040 & y<4140)
```

Viewing one of those Points of Interest
```{r}
modelPOI1 <- ggplot(POI1, aes(x,y)) +
  geom_pointdensity(adjust = 0.05, size = 0.1, shape = "1") + 
  scale_color_viridis(direction = -1, option = "B", trans = "log", breaks = c(10, 100, 1000)) + 
  coord_fixed()

modelPOI1
```

Figure 1.2.3
```{r}
modelPOI2 <- ggplot(POI2, aes(x,y)) +
  geom_pointdensity(adjust = 0.05, size = 0.1, shape = "1") + 
  scale_color_viridis(direction = -1, option = "B", trans = "log", breaks = c(10, 100, 1000)) + 
  coord_fixed()

modelPOI2
```

It's important to note that while a lot of the surrounding area appears to be empty, it is full of background observations. It appears blank as observations are darker in colour and more prominent when there is a higher number of other observations close by.

```{r}
RAWPOI1 <- ggplot(POI1, aes(x,y)) +
  geom_point(size = 0.5) +
  coord_fixed()

RAWPOI2<- ggplot(POI2, aes(x,y)) +
  geom_point(size = 0.5) +
  coord_fixed()

RAWPOI1
RAWPOI2
```



Before fitting a 2D Moffat Model, I want to simplify and fit a 1D model to see if it is the most appropriate fit to the data. To do that, I'm going to slice my celestial sources (POI's) into lines, with fewer observations and treat them as being one-dimensional. 


```{r}
modelCentral <- ggplot(Central, aes(x,y)) +
  geom_pointdensity(adjust = 0.05, size = 0.1, shape = "1") + 
  scale_color_viridis(direction = -1, option = "B", trans = "log", breaks = c(10, 100, 1000)) + 
  coord_fixed()

modelCentral
```

